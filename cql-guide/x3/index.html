<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Appendix 3: Control Directives | CG/SQL</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Appendix 3: Control Directives | CG/SQL"><meta data-react-helmet="true" name="description" content="&lt;!---"><meta data-react-helmet="true" property="og:description" content="&lt;!---"><meta data-react-helmet="true" property="og:url" content="https://cgsql.dev/cql-guide/x3"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cgsql.dev/cql-guide/x3"><link rel="stylesheet" href="/styles.cea8e77b.css">
<link rel="preload" href="/styles.778626fb.js" as="script">
<link rel="preload" href="/runtime~main.0f881e9d.js" as="script">
<link rel="preload" href="/main.b286a7e6.js" as="script">
<link rel="preload" href="/1.a28ac4da.js" as="script">
<link rel="preload" href="/2.4ad19ff1.js" as="script">
<link rel="preload" href="/3.54a9185d.js" as="script">
<link rel="preload" href="/1be78505.a85fb543.js" as="script">
<link rel="preload" href="/92.962ddb54.js" as="script">
<link rel="preload" href="/5456faf3.2d7f1dae.js" as="script">
<link rel="preload" href="/17896441.9880874c.js" as="script">
<link rel="preload" href="/c9569535.3d78ce47.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/cql-guide/ch01">CQL Guide</a><a class="navbar__item navbar__link" href="/cql-guide/int01">CQL Internals</a><a class="navbar__item navbar__link" href="/program-diagram">Railroad Diagram</a><a class="navbar__item navbar__link" href="/json-diagram">Railroad Diagram: JSON</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/cql-guide/ch01">CQL Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/cql-guide/int01">CQL Internals</a></li><li class="menu__list-item"><a class="menu__link" href="/program-diagram">Railroad Diagram</a></li><li class="menu__list-item"><a class="menu__link" href="/json-diagram">Railroad Diagram: JSON</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CQL Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch01">Chapter 1: Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch02">Chapter 2: Using Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch03">Chapter 3: Expressions, Literals, Nullability, Sensitivity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch04">Chapter 4: Procedures, Functions, and Control Flow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch05">Chapter 5: Types of Cursors, OUT and OUT UNION, and FETCH flavors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch06">Chapter 6: Calling Procedures Defined Elsewhere</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch07">Chapter 7: CQL Result Sets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch08">Chapter 8: Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch09">Chapter 9: Statements Summary and Error Checking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch10">Chapter 10: Schema Management Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch11">Chapter 11: Previous Schema Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch12">Chapter 12: Testability Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch13">Chapter 13: JSON Output</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch14">Chapter 14: CQL Query Fragments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x1">Appendix 1: Command Line Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x2">Appendix 2: CQL Grammar</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/cql-guide/x3">Appendix 3: Control Directives</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x4">Appendix 4: CQL Error Codes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x5">Appendix 5: JSON Schema Grammar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x6">Appendix 6: CQL In 20 Minutes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x7">Appendix 7: CQL Anti-patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x8">Appendix 8: CQL Best Practices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/x9">Appendix 9: Using the CQL Amalgam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CQL Internals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int01">Part 1: Lexing, Parsing, and the AST</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int02">Part 2: Semantic Analysis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int03">Part 3: C Code Generation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int04">Part 4: Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int05">Part 5: CQL Runtime</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int06">Part 6: Schema Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int07">Part 7: JSON Generation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/int08">Part 8: Test Helpers</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Appendix 3: Control Directives</h1></header><div class="markdown"><p>The control directives are those statements that begin with <code>@</code> and they are distinguished from other statements because they influence the compiler rather than the program logic.  Some of these are of great importance and discussed elsewhere.</p><p>The complete list (as of this writing) is:</p><p><code>@ENFORCE_STRICT</code>
<code>@ENFORCE_NORMAL</code></p><ul><li>These enable or disable more strict semanic checking the sub options are<ul><li><code>FOREIGN KEY ON UPDATE</code>: all FK&#x27;s must choose some <code>ON UPDATE</code> strategy</li><li><code>FOREIGN KEY ON DELETE</code>: all FK&#x27;s must choose some <code>ON DELETE</code> strategy</li><li><code>PROCEDURE</code>: all procedures must be declared before they are called (eliminating the vanilla <code>C</code> call option)</li><li><code>JOIN</code>: all joins must be ANSI style, the form <code>FROM A,B</code> is not allowed (replace with <code>A INNER JOIN B</code></li><li><code>WINDOW FUNC</code>: window functions are disallowed (useful if targeting old versions of SQLite)</li><li><code>UPSERT STATEMENT</code>: the upsert form is disallowed (useful if targeting old versions of SQLite)</li></ul></li></ul><p><code>@SENSITIVE</code></p><ul><li>marks a column or variable as &#x27;sensitive&#x27; for privacy purposes, this behaves somewhat like nullability (See Chapter 3) in that it is radioactive, contaminating anything it touches</li><li>the intent of this annotation is to make it clear where sensitive data is being returned or consumed in your procedures</li><li>this information appears in the JSON output for further codegen or for analysis (See Chapter 13)</li></ul><p><code>@DECLARE_SCHEMA_REGION</code>
<code>@DECLARE_DEPLOYABLE_REGION</code>
<code>@BEGIN_SCHEMA_REGION</code>
<code>@END_SCHEMA_REGION</code></p><ul><li>These directives control the declaration of schema regions and allow you to place things into those regions -- see <a href="https://cgsql.dev/cql-guide/ch10" target="_blank" rel="noopener noreferrer">Chapter 10</a></li></ul><p><code>@SCHEMA_AD_HOC_MIGRATION</code></p><ul><li>Allows for the creation of a ad hoc migration step at a given schema version, (See Chapter 10)</li></ul><p><code>@ECHO</code></p><ul><li>Emits text into the C output stream, useful for emiting things like function prototypes or preprocessor directives</li><li>e.g. `echo C, &#x27;#define foo bar&#x27;</li></ul><p><code>@RECREATE</code>
<code>@CREATE</code>
<code>@DELETE</code></p><ul><li>used to mark the schema version where an object is created or deleted, or alternatively indicate the the object is always dropped and recreated when it changes (See Chapter 10)</li></ul><p><code>@SCHEMA_UPGRADE_VERSION</code></p><ul><li>used to indicate that the code that follows is part of a migration script for the indicated schema version</li><li>this has the effect of making the schema appear to be how it existed at the indicated version</li><li>the idea here is that migration procedures operate on previous versions of the schema where (e.g.) some columns/tables hadn&#x27;t been deleted yet</li></ul><p><code>@PREVIOUS_SCHEMA</code></p><ul><li>indicates the start of the previous version of the schema for comparison (See Chapter 11)</li></ul><p><code>@SCHEMA_UPGRADE_SCRIPT</code></p><ul><li>CQL emits a schema upgrade script as part of its upgrade features, this script declares tables in their final form but also creates the same tables as they existed when they were first created</li><li>this directive instructs CQL to ignore the incompatible creations, the first declaration controls</li><li>the idea here is that the upgrade script is in the business of getting you to the finish line in an orderly fashion and some of the interim steps are just not all the way there yet</li><li>note that the upgrade script recapitulates the version history, it does not take you directly to the finish line, this is so that all instances get to the same place the same way (and this fleshes out any bugs in migration)</li></ul><p><code>@DUMMY_NULLABLES</code>
<code>@DUMMY_DEFAULTS</code>
<code>@DUMMY_SEED</code></p><ul><li>these control the creation of dummy data for <code>insert</code> and <code>fetch</code> statements (See Chapters 5 and 12)</li></ul><p><code>@FILE</code></p><ul><li>a string literal that corresponds to the current file name with a prefix stripped (to remove build lab junk in the path)</li></ul><p><code>@ATTRIBUTE</code></p><ul><li><p>the main purpose of <code>@attribute</code> is to appear in the JSON output so that it can control later codegen stages in whatever way you deem appropriate</p></li><li><p>the nested nature of attribute values is sufficiently flexible than you could encode an arbitrary LISP program in an attribute, so really anything you might need to express is possible</p></li><li><p>there are a number of attributes known to the compiler which I list below (complete as of this writing)</p></li><li><p><code>cql:autodrop=(table1, table2, ...)</code> when present the indicated tables, which must be temp tables, are dropped when the results of the procedure have been fetched into a rowset</p></li><li><p><code>cql:identity=(column1, column2, ...)</code> the indicated columns are used to create a row comparator for the rowset corresponding to the procedure, this appears in a C macro of the form <code>procedure_name_row_same(rowset1, row1, rowset2, row2)</code></p></li><li><p><code>cql:suppress_getters</code> the annotated procedure should not emit its related column getter functions.</p><ul><li>Useful if you only indend to call the procedure from CQL.</li><li>Saves code generation and removes the possibility of C code using the getters.</li></ul></li><li><p><code>cql:suppress_result_set</code> the annotated procedure should not emit its related &quot;fetch results&quot; function.</p><ul><li>Useful if you only indend to call the procedure from CQL.</li><li>Saves code generation and removes the possibility of C code using the result set or getters.</li><li>Implies <code>cql:suppress_getters</code>; since there is no result set, getters would be redundant.</li><li>Note: an <code>OUT UNION</code> procedure cannot have a suppressed result set since all such a procedure does is produce a result set. This attribute is ignored for out union procedures.</li></ul></li><li><p><code>cql:private</code> the annotated procedure will be static in the generated C</p><ul><li>Because the generated function is <code>static</code> it cannot be called from other modules and therefore will not go in any CQL exports file (that would be moot since you couldn&#x27;t call it).</li><li>This attribute also implies <code>cql:suppress_result_set</code> since only CQL code in the same translation unit could possibly call it and hence the result set procedure is useless to other C code.</li></ul></li><li><p><code>cql:generate_copy</code> the code generation for the annotated procedure will produce a <code>[procedure_name]_copy</code> function that can make complete or partial copies of its result set.</p></li><li><p><code>cql:base_fragment=frag_name</code> used for base fragments (See Chapter 14)</p></li><li><p><code>cql:extension_fragment=frag_name</code> used for extension fragments (See Chapter 14)</p></li><li><p><code>cql:assembly_fragment=frag_name</code> used for assembly fragments (See Chapter 14)</p></li><li><p><code>cql:no_table_scan</code> for query plan processing, indicates that the table in question should never be table scanned in any plan (for better diagnostics)</p></li><li><p><code>cql:autotest=([many forms])</code> declares various autotest features (See Chapter 12)</p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-12-02T11:11:32.000Z" class="docLastUpdatedAt_217_">12/2/2021</time> by <strong>Rico Mariani</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cql-guide/x2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Appendix 2: CQL Grammar</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cql-guide/x4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Appendix 4: CQL Error Codes Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.youtube.com/channel/UC2lTapw2Um90sZpGQVaynEg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Meta Platforms Open Source Logo" src="/img/oss_logo.png"></a></div><div>Copyright Â© 2021 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.778626fb.js"></script>
<script src="/runtime~main.0f881e9d.js"></script>
<script src="/main.b286a7e6.js"></script>
<script src="/1.a28ac4da.js"></script>
<script src="/2.4ad19ff1.js"></script>
<script src="/3.54a9185d.js"></script>
<script src="/1be78505.a85fb543.js"></script>
<script src="/92.962ddb54.js"></script>
<script src="/5456faf3.2d7f1dae.js"></script>
<script src="/17896441.9880874c.js"></script>
<script src="/c9569535.3d78ce47.js"></script>
</body>
</html>