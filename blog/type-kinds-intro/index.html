<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Introducing Type &quot;Kinds&quot; | CG/SQL</title><meta data-react-helmet="true" property="og:title" content="Introducing Type &quot;Kinds&quot; | CG/SQL"><meta data-react-helmet="true" name="description" content="Further adding to the type calculus of the CQL language we introduced the ability to encode the &quot;kind&quot; of primitive types.  This"><meta data-react-helmet="true" property="og:description" content="Further adding to the type calculus of the CQL language we introduced the ability to encode the &quot;kind&quot; of primitive types.  This"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/styles.4959ceee.css">
<link rel="preload" href="/styles.dc8dd41c.js" as="script">
<link rel="preload" href="/runtime~main.d59f8f31.js" as="script">
<link rel="preload" href="/main.d2883094.js" as="script">
<link rel="preload" href="/1.45596a91.js" as="script">
<link rel="preload" href="/2.a6a208e8.js" as="script">
<link rel="preload" href="/3.8524ddf0.js" as="script">
<link rel="preload" href="/ccc49370.cc5e130f.js" as="script">
<link rel="preload" href="/3dc9b960.94a1dc4b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/cql-guide/ch01">CQL Guide</a><a class="navbar__item navbar__link" href="/cql-guide/int01">CQL Internals</a><a class="navbar__item navbar__link" href="/program-diagram">Railroad Diagram</a><a class="navbar__item navbar__link" href="/json-diagram">Railroad Diagram: JSON</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/cql-guide/ch01">CQL Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/cql-guide/int01">CQL Internals</a></li><li class="menu__list-item"><a class="menu__link" href="/program-diagram">Railroad Diagram</a></li><li class="menu__list-item"><a class="menu__link" href="/json-diagram">Railroad Diagram: JSON</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_1mse">Introducing Type &quot;Kinds&quot;</h1><div class="margin-vert--md"><time datetime="2021-01-20T00:00:00.000Z" class="blogPostDate_3bQP">January 20, 2021  Â· 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/facebookincubator" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/69631?s=200&amp;v=4" alt="CG/SQL Team"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/facebookincubator" target="_blank" rel="noreferrer noopener">CG/SQL Team</a></h4><small class="avatar__subtitle">Maintainer of CG/SQL</small></div></div></header><section class="markdown"><p>Further adding to the type calculus of the CQL language we introduced the ability to encode the &quot;kind&quot; of primitive types.  This
can be used in a number of ways -- like &quot;units&quot; for natural things and like a &quot;type&quot; for synthetic keys and other such.  It&#x27;s easier
to illustrate by example.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare job_id type long&lt;job_id&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare person_id type long&lt;person_id&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare j job_id;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">decalre p person_id;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set p := j;  -- this is an error</span></div></div></div></div></div><p>With the above in place, other expressions like  <code>p == j</code> would also produce errors as these <code>long</code> values are no longer type compatible.  This is
a great way to add enforcement to your schema and procedures.  Likewise you can use these annotations to add &quot;units&quot; to your data types.  e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare meters type real&lt;meters&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare grams type real&lt;grams&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare m meters;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare g grams;</span></div></div></div></div></div><p>Variables of type <code>grams</code> (e.g. <code>g</code>) are not compatible with variables of type <code>meters</code> (e.g. <code>m</code>) even though both are <code>real</code>.</p><p>Likewise, attemping to insert <code>grams</code> into a column that is typed to <code>meters</code> will give errors.  Of course SQLite doesn&#x27;t know about any of this
so all the <code>&lt;&gt;</code> stuff is removed in the generated SQL.  This is just about type enforcement at compile time.</p><p>Enumerations like:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum surface integer (paper, canvas);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum writer integer (pen, paper, brush);</span></div></div></div></div></div><p>enable this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare s surface;                  -- s is now of type integer&lt;surface&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare w writer;                   -- w is now of type integer&lt;writer&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set s := surface.paper;             -- ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set s := writer.pen;                -- error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set w := writer.pencil;             -- ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">case when s == w then 1 else 0 end; -- error (w/s not comparable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set w := s;                         -- error again</span></div></div></div></div></div><p>additionally in DML/DDL:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table draw_action(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  w writer,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  s surface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into draw_action values(w, s); -- ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">insert into draw_action values(s, w); -- error!</span></div></div></div></div></div><p>So the type kinds can be quite helpful when dealing with loose variables.</p><p>The notion of specific types was added to the language nearly two years ago to support the <code>object</code> type because there was a great desire
to prevent <code>object&lt;dictionary&gt;</code> being assigned from <code>object&lt;list&gt;</code> but this &quot;type kind&quot;, whether it&#x27;s with units (e.g. &quot;meters&quot;, &quot;grams&quot;)
or a type name (e.g. &quot;job_id&quot;) adds a lot of high value type checking.</p><p>The kind can be added, stripped, or changed with a <code>cast</code> operation and the type system allows a constant or variable with no kind (e.g. &quot;1&quot;)
to mix and match with any kind so long as the base type is compatible as usual.  So you get the most value by using the specific type
consistently but you won&#x27;t go insane adding test cases that use constants for instance.</p><p>As of this writing the expression kinds are checked for compatibility everywhere plus or minus bugs.  There are extensive tests.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/facebook">facebook</a><a class="margin-horiz--sm" href="/blog/tags/cg-sql">cg-sql</a></div></footer></article><div><a href="https://github.com/facebookincubator/CG-SQL/edit/master/website/blog/blog/2021-01-20-type-kinds-intro.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/free-empty-results"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Change in No-Result Semantics</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/named-types-into"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Introducing Named Types Â»</div></a></div></nav></div></div><div class="col col--2"><div class="tableOfContents_3SO_"></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.youtube.com/channel/UC2lTapw2Um90sZpGQVaynEg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Meta Platforms Open Source Logo" src="/img/oss_logo.png"></a></div><div>Copyright Â© 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.dc8dd41c.js"></script>
<script src="/runtime~main.d59f8f31.js"></script>
<script src="/main.d2883094.js"></script>
<script src="/1.45596a91.js"></script>
<script src="/2.a6a208e8.js"></script>
<script src="/3.8524ddf0.js"></script>
<script src="/ccc49370.cc5e130f.js"></script>
<script src="/3dc9b960.94a1dc4b.js"></script>
</body>
</html>